<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ID Card Generator</title>
<link rel="icon" type="image/png" href="https://i.imgur.com/7H8vd0v.png" />



  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: #f4f7fa;
      color: #333;
    }

    .container {
      max-width: 750px;
      margin: 40px auto;
      padding: 30px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }

    .centered {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      padding: 20px;
    }

    h1, h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    button {
      background: #0077cc;
      color: white;
      padding: 15px 30px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background: #005fa3;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    input, select, textarea {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      font-family: inherit;
    }

    input, textarea {
      width: 100%;
    }

    select {
      width: 100%;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background: white url('data:image/svg+xml;utf8,<svg fill="gray" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 10px center;
      background-size: 16px;
    }
  
#idCard {
  width: 3.375in;
  height: 2.125in;
  display: flex;
  align-items: flex-start;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: #ffffff;
  font-size: 12px;
  font-family: "Segoe UI", sans-serif;
  position: relative;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  overflow: hidden;
}

#idCard img {
  width: 0.9in;
  height: 1in;
  object-fit: cover;
  border-radius: 4px;
  margin: 0.125in;
  flex-shrink: 0;
}


#idCard .card-details {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  padding: 0.1in 0.125in 0.1in 0;
  font-size: 11px;
  flex: 1;
}

#idCard .card-details p {
  margin: 0.05in 0;
  line-height: 1.2;
}

.footerDisclaimer {
  position: absolute;
  bottom: 8px;
  left: 12px;
  font-size: 9px;
  color: #555;
  font-style: italic;
  opacity: 0.7;
}


#qr {
  width: 1in;
  height: 1in;
  display: flex;
  justify-content: center;
  align-items: center;
  position: absolute;
  bottom: 0.125in;
  right: 0.125in;
}

#qr canvas {
  width: 1in !important;
  height: 1in !important;
  border-radius: 8px;
  image-rendering: pixelated;
  border: 1px solid #ccc;
  padding: 2px;
  background-color: white;
  
}

.card-header {
  background-color: #004080;
  color: white;
  text-align: center;
  padding: 0.1in;
  font-weight: bold;
  font-size: 13px;
}


    .row {
  display: flex;
  flex-wrap: wrap;
  gap: 5px; /* small spacing */
  align-items: flex-start;
}

    .row .country-code {
      width: 110px;
       flex: 0 0 auto;
  min-width: 110px;
      padding: 8px;
      font-size: 1rem;
    }



/* The error message should be full width below input */
.phone-error {
  width: 100%;
  margin-top: 2px;
  display: block;
  color: red;
  font-size: 0.75rem;
  line-height: 1.1;
}
      .row input[type="tel"] {
      flex: 1;
      padding: 8px;
      font-size: 1rem;
    }

    .hidden {
      display: none;
    }
    #actionButtons button {
  background: #0077cc;
  color: white;
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  margin-right: 15px;
}

#actionButtons button:hover {
  background: #005fa3;
}
#printInstructions {
  display: none;
}
#imagePreview {
  max-width: 100%;
  display: none;
  margin-top: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

#cropBtn {
  display: none;
  margin-top: 10px;
  padding: 6px 12px;
  font-size: 14px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

#cropBtn:hover {
  background-color: #0056b3;
}

#cropNotice {
  display: none;
  color: green;
  margin-left: 12px;
}

#finalPhoto {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-bottom: 10px;
}


.form-group-nationality {
  margin-bottom: 20px;
}

.form-group-nationality label {
  display: block;
  font-weight: 600;
  margin-bottom: 8px;
  color: #333;
}

.form-group-nationality select {
  width: 100%;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 15px;
  background-color: #fff;
  transition: border-color 0.3s, box-shadow 0.3s;
}

.form-group-nationality select:focus {
  border-color: #007BFF;
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.15);
  outline: none;
}


@media (max-width: 480px) {
      .container {
        margin: 20px 15px;
        padding: 20px 15px;
      }

      /* Stack flex rows vertically */
      .row {
        flex-direction: column;
        align-items: stretch;
      }

      .row .country-code {
        width: 100%;
        min-width: auto;
        margin-bottom: 8px;
      }

      /* Make ID card vertical and responsive */
      #idCard {
        flex-direction: column;
        height: auto;  /* allow growing */
        width: 100%;
        padding: 0.2in 0.15in;
      }

      #idCard img {
        width: 1.2in;
        height: 1.6in;
        margin: 0 auto 10px auto;
        border-radius: 6px;
      }

      #idCard .card-details {
        padding: 0 10px 10px 10px;
        font-size: 10px;
        text-align: center;
      }
      


      #qr {
        position: static;
        margin: 10px auto 0 auto;
        width: 1.5in;
        height: 1.5in;
      }

      #qr canvas {
        width: 1.5in !important;
        height: 1.5in !important;
      }

      button {
        width: 100%;
        font-size: 16px;
        padding: 12px 0;
      }
    }
    
    .logo {
      max-width: 200px;
      margin-bottom: 20px;
    }
    footer {
  margin-top: 40px;
  text-align: center;
  font-size: 0.85rem;
  color: #777;
  padding: 20px 10px;
  border-top: 1px solid #ccc;
}

  </style>
</head>
<body>
  <h1>ID Card Generator</h1>
<div id="intro" class="centered">
  <div class="container">
    <h1>ID Card Creator</h1>
    <p>
  This website helps you generate a digital ID card containing your vital information along with a scannable QR code. In emergencies, scanning the QR code can quickly provide essential details to first responders, potentially saving time and lives. The ID card includes your photo, full name, institution, date of birth, blood group, and emergency contact information — all securely embedded within the QR code for easy access.<br><br>
  Built using modern HTML5 and web technologies, this tool ensures a seamless and user-friendly experience without requiring any downloads or installations. Your data stays on your device and is only encoded into the QR code, providing a safe and private way to carry your emergency information wherever you go.
</p>

    <button onclick="showForm()">Create ID Card</button>
  </div>
</div>

<div id="formSection" class="container hidden">
  <h2>Enter Your Information</h2>

  <div class="form-group">
  <label for="name">Full Name <span style="color: red;">*</span></label>
  <input type="text" id="name" maxlength="30" placeholder="Enter full name (max 30 characters)" />
  <small id="nameCount">0/30</small>
</div>

  <div class="form-group">
    <label for="dob">Date of Birth <span style="color: red;">*</span></label>
    <input type="date" id="dob" />
  </div>

  <div class="form-group">
  <label for="institution">Institution Name <span style="color: red;">*</span></label>
  <input type="text" id="institution" maxlength="42" placeholder="Enter institution (max 42 characters)" />
  <small id="instCount">0/42</small>
</div>

  <div class="form-group">
    <label for="blood">Blood Group <span style="color: red;">*</span></label>
    <select id="blood">
      <option value="">Select</option>
      <option>A+</option><option>A-</option>
      <option>B+</option><option>B-</option>
      <option>AB+</option><option>AB-</option>
      <option>O+</option><option>O-</option>
    </select>
  </div>

  <div class="form-group">
    <label for="gender">Gender <span style="color: red;">*</span></label>
    <select id="gender">
      <option value="">Select</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>
  </div>

  <div class="form-group-nationality">
  <label for="nationality">Nationality <span style="color: red;">*</span></label>
  <select id="nationality">
    <option value="">Select Country</option>
    <option value="Afghanistan">Afghanistan</option>
    <option value="Albania">Albania</option>
    <option value="Algeria">Algeria</option>
    <option value="Andorra">Andorra</option>
    <option value="Angola">Angola</option>
    <option value="Argentina">Argentina</option>
    <option value="Armenia">Armenia</option>
    <option value="Australia">Australia</option>
    <option value="Austria">Austria</option>
    <option value="Azerbaijan">Azerbaijan</option>
    <option value="Bahamas">Bahamas</option>
    <option value="Bahrain">Bahrain</option>
    <option value="Bangladesh">Bangladesh</option>
    <option value="Barbados">Barbados</option>
    <option value="Belarus">Belarus</option>
    <option value="Belgium">Belgium</option>
    <option value="Belize">Belize</option>
    <option value="Benin">Benin</option>
    <option value="Bhutan">Bhutan</option>
    <option value="Bolivia">Bolivia</option>
    <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
    <option value="Botswana">Botswana</option>
    <option value="Brazil">Brazil</option>
    <option value="Brunei">Brunei</option>
    <option value="Bulgaria">Bulgaria</option>
    <option value="Burkina Faso">Burkina Faso</option>
    <option value="Burundi">Burundi</option>
    <option value="Cambodia">Cambodia</option>
    <option value="Cameroon">Cameroon</option>
    <option value="Canada">Canada</option>
    <option value="Chad">Chad</option>
    <option value="Chile">Chile</option>
    <option value="China">China</option>
    <option value="Colombia">Colombia</option>
    <option value="Comoros">Comoros</option>
    <option value="Costa Rica">Costa Rica</option>
    <option value="Croatia">Croatia</option>
    <option value="Cuba">Cuba</option>
    <option value="Cyprus">Cyprus</option>
    <option value="Czech Republic">Czech Republic</option>
    <option value="Denmark">Denmark</option>
    <option value="Djibouti">Djibouti</option>
    <option value="Dominica">Dominica</option>
    <option value="Dominican Republic">Dominican Republic</option>
    <option value="Ecuador">Ecuador</option>
    <option value="Egypt">Egypt</option>
    <option value="El Salvador">El Salvador</option>
    <option value="Equatorial Guinea">Equatorial Guinea</option>
    <option value="Eritrea">Eritrea</option>
    <option value="Estonia">Estonia</option>
    <option value="Eswatini">Eswatini</option>
    <option value="Ethiopia">Ethiopia</option>
    <option value="Fiji">Fiji</option>
    <option value="Finland">Finland</option>
    <option value="France">France</option>
    <option value="Gabon">Gabon</option>
    <option value="Gambia">Gambia</option>
    <option value="Georgia">Georgia</option>
    <option value="Germany">Germany</option>
    <option value="Ghana">Ghana</option>
    <option value="Greece">Greece</option>
    <option value="Grenada">Grenada</option>
    <option value="Guatemala">Guatemala</option>
    <option value="Guinea">Guinea</option>
    <option value="Guyana">Guyana</option>
    <option value="Haiti">Haiti</option>
    <option value="Honduras">Honduras</option>
    <option value="Hungary">Hungary</option>
    <option value="Iceland">Iceland</option>
    <option value="India">India</option>
    <option value="Indonesia">Indonesia</option>
    <option value="Iran">Iran</option>
    <option value="Iraq">Iraq</option>
    <option value="Ireland">Ireland</option>
    <option value="Israel">Israel</option>
    <option value="Italy">Italy</option>
    <option value="Jamaica">Jamaica</option>
    <option value="Japan">Japan</option>
    <option value="Jordan">Jordan</option>
    <option value="Kazakhstan">Kazakhstan</option>
    <option value="Kenya">Kenya</option>
    <option value="Kuwait">Kuwait</option>
    <option value="Kyrgyzstan">Kyrgyzstan</option>
    <option value="Laos">Laos</option>
    <option value="Latvia">Latvia</option>
    <option value="Lebanon">Lebanon</option>
    <option value="Lesotho">Lesotho</option>
    <option value="Liberia">Liberia</option>
    <option value="Libya">Libya</option>
    <option value="Liechtenstein">Liechtenstein</option>
    <option value="Lithuania">Lithuania</option>
    <option value="Luxembourg">Luxembourg</option>
    <option value="Madagascar">Madagascar</option>
    <option value="Malawi">Malawi</option>
    <option value="Malaysia">Malaysia</option>
    <option value="Maldives">Maldives</option>
    <option value="Mali">Mali</option>
    <option value="Malta">Malta</option>
    <option value="Mauritania">Mauritania</option>
    <option value="Mauritius">Mauritius</option>
    <option value="Mexico">Mexico</option>
    <option value="Moldova">Moldova</option>
    <option value="Monaco">Monaco</option>
    <option value="Mongolia">Mongolia</option>
    <option value="Montenegro">Montenegro</option>
    <option value="Morocco">Morocco</option>
    <option value="Mozambique">Mozambique</option>
    <option value="Myanmar">Myanmar</option>
    <option value="Namibia">Namibia</option>
    <option value="Nepal">Nepal</option>
    <option value="Netherlands">Netherlands</option>
    <option value="New Zealand">New Zealand</option>
    <option value="Nicaragua">Nicaragua</option>
    <option value="Niger">Niger</option>
    <option value="Nigeria">Nigeria</option>
    <option value="North Korea">North Korea</option>
    <option value="North Macedonia">North Macedonia</option>
    <option value="Norway">Norway</option>
    <option value="Oman">Oman</option>
    <option value="Pakistan">Pakistan</option>
    <option value="Palestine">Palestine</option>
    <option value="Panama">Panama</option>
    <option value="Papua New Guinea">Papua New Guinea</option>
    <option value="Paraguay">Paraguay</option>
    <option value="Peru">Peru</option>
    <option value="Philippines">Philippines</option>
    <option value="Poland">Poland</option>
    <option value="Portugal">Portugal</option>
    <option value="Qatar">Qatar</option>
    <option value="Romania">Romania</option>
    <option value="Russia">Russia</option>
    <option value="Rwanda">Rwanda</option>
    <option value="Saint Lucia">Saint Lucia</option>
    <option value="Samoa">Samoa</option>
    <option value="Saudi Arabia">Saudi Arabia</option>
    <option value="Senegal">Senegal</option>
    <option value="Serbia">Serbia</option>
    <option value="Seychelles">Seychelles</option>
    <option value="Singapore">Singapore</option>
    <option value="Slovakia">Slovakia</option>
    <option value="Slovenia">Slovenia</option>
    <option value="Somalia">Somalia</option>
    <option value="South Africa">South Africa</option>
    <option value="South Korea">South Korea</option>
    <option value="Spain">Spain</option>
    <option value="Sri Lanka">Sri Lanka</option>
    <option value="Sudan">Sudan</option>
    <option value="Suriname">Suriname</option>
    <option value="Sweden">Sweden</option>
    <option value="Switzerland">Switzerland</option>
    <option value="Syria">Syria</option>
    <option value="Taiwan">Taiwan</option>
    <option value="Tajikistan">Tajikistan</option>
    <option value="Tanzania">Tanzania</option>
    <option value="Thailand">Thailand</option>
    <option value="Togo">Togo</option>
    <option value="Tonga">Tonga</option>
    <option value="Trinidad and Tobago">Trinidad and Tobago</option>
    <option value="Tunisia">Tunisia</option>
    <option value="Turkey">Turkey</option>
    <option value="Turkmenistan">Turkmenistan</option>
    <option value="Uganda">Uganda</option>
    <option value="Ukraine">Ukraine</option>
    <option value="United Arab Emirates">United Arab Emirates</option>
    <option value="United Kingdom">United Kingdom</option>
    <option value="United States">United States</option>
    <option value="Uruguay">Uruguay</option>
    <option value="Uzbekistan">Uzbekistan</option>
    <option value="Vanuatu">Vanuatu</option>
    <option value="Venezuela">Venezuela</option>
    <option value="Vietnam">Vietnam</option>
    <option value="Yemen">Yemen</option>
    <option value="Zambia">Zambia</option>
    <option value="Zimbabwe">Zimbabwe</option>
  </select>
</div>


  <!-- Emergency Contacts -->
  <!-- Emergency Contacts -->
<h3>Emergency Contacts <span style="color: red;">*</span></h3>
<div id="emergencyContactsContainer">
    <label>Father's Number <span style="color: red;">*</span></label>
    <div class="row">
      <select id="fatherCode" class="country-code">${countryOptions}</select>
      <input type="tel" id="father" placeholder="Father's Phone Number" required />
    </div>
  </div>

  <div class="form-group">
    <label>Mother's Number <span style="color: red;">*</span></label>
    <div class="row">
      <select id="motherCode" class="country-code">${countryOptions}</select>
      <input type="tel" id="mother" placeholder="Mother's Phone Number" required />
    </div>
  </div>

  <div class="form-group">
    <label>Brother's Number</label>
    <div class="row">
      <select id="brotherCode" class="country-code">${countryOptions}</select>
      <input type="tel" id="brother" placeholder="Brother's Phone Number" />
    </div>
  </div>

  <div class="form-group">
    <label>Sister's Number</label>
    <div class="row">
      <select id="sisterCode" class="country-code">${countryOptions}</select>
      <input type="tel" id="sister" placeholder="Sister's Phone Number" />
    </div>
  </div>

  <div class="form-group">
    <label>Uncle's Number</label>
    <div class="row">
      <select id="uncleCode" class="country-code">${countryOptions}</select>
      <input type="tel" id="uncle" placeholder="Uncle's Phone Number" />
    </div>
  </div>

  <div class="form-group">
    <label>Aunty's Number</label>
    <div class="row">
      <select id="auntyCode" class="country-code">${countryOptions}</select>
      <input type="tel" id="aunty" placeholder="Aunty's Phone Number" />
    </div>
  </div>
  <div class="form-group">
  <label for="address">Address <span style="color: red;">*</span></label>
  <textarea id="address" rows="3"></textarea>
</div>

<div class="form-group" style="position: relative;">
  <label for="photo">Select Photo <span style="color: red;">*</span></label>
  <input type="file" accept="image/*" id="photo" />
  <img id="imagePreview" />
  <button id="cropBtn" type="button">Crop</button>
  <span id="cropNotice">✅ Image added to ID card.</span>
</div>





  <button onclick="generateID()">Generate ID Card</button>




<section id="output" class="hidden">
  <div id="idCard">
    <!-- Photo Placeholder on ID Card -->
    <img id="finalPhoto" src="" alt="Photo" />


    <div class="card-details">
      <div class="card-header">Student Emergency ID Card</div>

      <p><strong>Name:</strong> <span id="outName">N/A</span></p>
      <p><strong>Institution:</strong> <span id="outInst">N/A</span></p>
      <p><strong>DOB:</strong> <span id="outDOB">N/A</span></p>
      <p><strong>Blood Group:</strong> <span id="outBlood">N/A</span></p>
      <p><strong>Gender:</strong> <span id="outGender">N/A</span></p>
      <div class="footerDisclaimer">For Emergency Use Only!</div>

      

    </div>

    <div id="qr"></div>
  </div>
</section>


  <div id="actionButtons" style="margin-top: 20px; display: none;">
    <button id="downloadBtn">Download PNG</button>
    <button id="printBtn">Print ID Card</button>
    <button id="newIDBtn">Generate New ID</button>

  </div>
</div>

</div>
</div>


<div id="printInstructions" style="margin-top: 15px; font-size: 0.9rem; color: #444; max-width: 600px;">
  <strong>Printing Tips for Best Results:</strong>
  <ul style="padding-left: 20px; margin-top: 5px;">
    <li>Select <em>“Actual size”</em> or <em>100%</em> scaling in the print dialog.</li>
    <li>Disable options like <em>“Fit to page”</em> or <em>“Shrink to fit”</em>.</li>
    <li>Set margins to <em>None</em> or <em>Minimum</em> if available.</li>
    <li>Use good quality photo or card stock paper if possible.</li>
  </ul>
</div>

  
<footer>
  &copy; <span id="yearRange"></span> | This tool is intended solely for generating ID cards for emergency use.<br>
  Not affiliated with any official organization or institution.
</footer>

<script>
  const startYear = 2025;
  const currentYear = new Date().getFullYear();
  document.getElementById("yearRange").textContent = 
    startYear === currentYear ? `${startYear}` : `${startYear}–${currentYear}`;
</script>


<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.js"></script>


<script>
  const countryOptions = `
  <option value="+93">🇦🇫 +93</option>
  <option value="+355">🇦🇱 +355</option>
  <option value="+213">🇩🇿 +213</option>
  <option value="+1-684">🇦🇸 +1-684</option>
  <option value="+376">🇦🇩 +376</option>
  <option value="+244">🇦🇴 +244</option>
  <option value="+1-264">🇦🇮 +1-264</option>
  <option value="+672">🇦🇮 +672</option>
  <option value="+1-268">🇦🇬 +1-268</option>
  <option value="+54">🇦🇷 +54</option>
  <option value="+374">🇦🇲 +374</option>
  <option value="+61">🇦🇺 +61</option>
  <option value="+43">🇦🇹 +43</option>
  <option value="+994">🇦🇿 +994</option>
  <option value="+1-242">🇧🇸 +1-242</option>
  <option value="+973">🇧🇭 +973</option>
  <option value="+880" selected>🇧🇩 +880</option>
  <option value="+1-246">🇧🇧 +1-246</option>
  <option value="+375">🇧🇾 +375</option>
  <option value="+32">🇧🇪 +32</option>
  <option value="+501">🇧🇿 +501</option>
  <option value="+229">🇧🇯 +229</option>
  <option value="+1-441">🇧🇲 +1-441</option>
  <option value="+975">🇧🇹 +975</option>
  <option value="+591">🇧🇴 +591</option>
  <option value="+387">🇧🇦 +387</option>
  <option value="+267">🇧🇼 +267</option>
  <option value="+55">🇧🇷 +55</option>
  <option value="+246">🇮🇴 +246</option>
  <option value="+1-284">🇻🇬 +1-284</option>
  <option value="+673">🇧🇳 +673</option>
  <option value="+359">🇧🇬 +359</option>
  <option value="+226">🇧🇫 +226</option>
  <option value="+257">🇧🇮 +257</option>
  <option value="+855">🇰🇭 +855</option>
  <option value="+237">🇨🇲 +237</option>
  <option value="+1">🇨🇦 +1</option>
  <option value="+238">🇨🇻 +238</option>
  <option value="+236">🇨🇫 +236</option>
  <option value="+235">🇹🇩 +235</option>
  <option value="+56">🇨🇱 +56</option>
  <option value="+86">🇨🇳 +86</option>
  <option value="+61">🇨🇽 +61</option>
  <option value="+57">🇨🇴 +57</option>
  <option value="+269">🇰🇲 +269</option>
  <option value="+242">🇨🇬 +242</option>
  <option value="+243">🇨🇩 +243</option>
  <option value="+682">🇨🇰 +682</option>
  <option value="+506">🇨🇷 +506</option>
  <option value="+385">🇭🇷 +385</option>
  <option value="+53">🇨🇺 +53</option>
  <option value="+599">🇨🇼 +599</option>
  <option value="+357">🇨🇾 +357</option>
  <option value="+420">🇨🇿 +420</option>
  <option value="+45">🇩🇰 +45</option>
  <option value="+253">🇩🇯 +253</option>
  <option value="+1767">🇩🇲 +1767</option>
  <option value="+1-767">🇩🇲 +1-767</option>
  <option value="+1809">🇩🇴 +1809</option>
  <option value="+593">🇪🇨 +593</option>
  <option value="+20">🇪🇬 +20</option>
  <option value="+503">🇸🇻 +503</option>
  <option value="+240">🇬🇶 +240</option>
  <option value="+291">🇪🇷 +291</option>
  <option value="+372">🇪🇪 +372</option>
  <option value="+251">🇪🇹 +251</option>
  <option value="+500">🇫🇰 +500</option>
  <option value="+298">🇫🇴 +298</option>
  <option value="+679">🇫🇯 +679</option>
  <option value="+358">🇫🇮 +358</option>
  <option value="+33">🇫🇷 +33</option>
  <option value="+594">🇬🇫 +594</option>
  <option value="+689">🇵🇫 +689</option>
  <option value="+241">🇬🇦 +241</option>
  <option value="+220">🇬🇲 +220</option>
  <option value="+995">🇬🇪 +995</option>
  <option value="+49">🇩🇪 +49</option>
  <option value="+233">🇬🇭 +233</option>
  <option value="+350">🇬🇮 +350</option>
  <option value="+30">🇬🇷 +30</option>
  <option value="+299">🇬🇱 +299</option>
  <option value="+1-473">🇬🇩 +1-473</option>
  <option value="+590">🇬🇵 +590</option>
  <option value="+1-671">🇬🇺 +1-671</option>
  <option value="+502">🇬🇹 +502</option>
  <option value="+44">🇬🇧 +44</option>
  <option value="+224">🇬🇳 +224</option>
  <option value="+245">🇬🇼 +245</option>
  <option value="+595">🇵🇾 +595</option>
  <option value="+509">🇭🇹 +509</option>
  <option value="+504">🇭🇳 +504</option>
  <option value="+852">🇭🇰 +852</option>
  <option value="+36">🇭🇺 +36</option>
  <option value="+354">🇮🇸 +354</option>
  <option value="+91">🇮🇳 +91</option>
  <option value="+62">🇮🇩 +62</option>
  <option value="+98">🇮🇷 +98</option>
  <option value="+964">🇮🇶 +964</option>
  <option value="+353">🇮🇪 +353</option>
  <option value="+972">🇮🇱 +972</option>
  <option value="+39">🇮🇹 +39</option>
  <option value="+1-876">🇯🇲 +1-876</option>
  <option value="+81">🇯🇵 +81</option>
  <option value="+962">🇯🇴 +962</option>
  <option value="+7">🇰🇿 +7</option>
  <option value="+254">🇰🇪 +254</option>
  <option value="+686">🇰🇮 +686</option>
  <option value="+965">🇰🇼 +965</option>
  <option value="+996">🇰🇬 +996</option>
  <option value="+371">🇱🇻 +371</option>
  <option value="+266">🇱🇸 +266</option>
  <option value="+231">🇱🇷 +231</option>
  <option value="+218">🇱🇾 +218</option>
  <option value="+423">🇱🇮 +423</option>
  <option value="+370">🇱🇹 +370</option>
  <option value="+352">🇱🇺 +352</option>
  <option value="+853">🇲🇴 +853</option>
  <option value="+389">🇲🇰 +389</option>
  <option value="+261">🇲🇬 +261</option>
  <option value="+265">🇲🇼 +265</option>
  <option value="+60">🇲🇾 +60</option>
  <option value="+960">🇲🇻 +960</option>
  <option value="+223">🇲🇱 +223</option>
  <option value="+356">🇲🇹 +356</option>
  <option value="+692">🇲🇭 +692</option>
  <option value="+222">🇲🇷 +222</option>
  <option value="+230">🇲🇺 +230</option>
  <option value="+262">🇾🇹 +262</option>
  <option value="+52">🇲🇽 +52</option>
  <option value="+691">🇫🇲 +691</option>
  <option value="+373">🇲🇩 +373</option>
  <option value="+377">🇲🇨 +377</option>
  <option value="+976">🇲🇳 +976</option>
  <option value="+382">🇲🇪 +382</option>
  <option value="+1-664">🇲🇸 +1-664</option>
  <option value="+212">🇲🇦 +212</option>
  <option value="+258">🇲🇿 +258</option>
  <option value="+95">🇲🇲 +95</option>
  <option value="+264">🇳🇦 +264</option>
  <option value="+674">🇳🇷 +674</option>
  <option value="+977">🇳🇵 +977</option>
  <option value="+31">🇳🇱 +31</option>
  <option value="+687">🇳🇨 +687</option>
  <option value="+64">🇳🇿 +64</option>
  <option value="+505">🇳🇮 +505</option>
  <option value="+227">🇳🇪 +227</option>
  <option value="+234">🇳🇬 +234</option>
  <option value="+683">🇳🇺 +683</option>
  <option value="+672">🇳🇫 +672</option>
  <option value="+1-670">🇵🇼 +1-670</option>
  <option value="+47">🇳🇴 +47</option>
  <option value="+968">🇴🇲 +968</option>
  <option value="+92">🇵🇰 +92</option>
  <option value="+680">🇵🇼 +680</option>
  <option value="+507">🇵🇦 +507</option>
  <option value="+675">🇵🇬 +675</option>
  <option value="+595">🇵🇾 +595</option>
  <option value="+51">🇵🇪 +51</option>
  <option value="+63">🇵🇭 +63</option>
  <option value="+48">🇵🇱 +48</option>
  <option value="+351">🇵🇹 +351</option>
  <option value="+1-784">🇸🇻 +1-784</option>
  <option value="+974">🇶🇦 +974</option>
  <option value="+40">🇷🇴 +40</option>
  <option value="+7">🇷🇺 +7</option>
  <option value="+250">🇷🇼 +250</option>
  <option value="+590">🇧🇱 +590</option>
  <option value="+290">🇸🇭 +290</option>
  <option value="+1-869">🇰🇳 +1-869</option>
  <option value="+1-758">🇱🇨 +1-758</option>
  <option value="+508">🇵🇲 +508</option>
  <option value="+1-784">🇻🇨 +1-784</option>
  <option value="+685">🇼🇸 +685</option>
  <option value="+378">🇸🇲 +378</option>
  <option value="+239">🇸🇹 +239</option>
  <option value="+966">🇸🇦 +966</option>
  <option value="+221">🇸🇳 +221</option>
  <option value="+381">🇷🇸 +381</option>
  <option value="+248">🇸🇨 +248</option>
  <option value="+232">🇸🇱 +232</option>
  <option value="+65">🇸🇬 +65</option>
  <option value="+1721">🇸🇽 +1721</option>
  <option value="+421">🇸🇰 +421</option>
  <option value="+386">🇸🇮 +386</option>
  <option value="+677">🇸🇧 +677</option>
  <option value="+27">🇿🇦 +27</option>
  <option value="+500">🇬🇫 +500</option>
  <option value="+211">🇸🇸 +211</option>
  <option value="+34">🇪🇸 +34</option>
  <option value="+94">🇱🇰 +94</option>
  <option value="+249">🇸🇩 +249</option>
  <option value="+597">🇸🇷 +597</option>
  <option value="+268">🇸🇿 +268</option>
  <option value="+46">🇸🇪 +46</option>
  <option value="+41">🇨🇭 +41</option>
  <option value="+963">🇸🇾 +963</option>
  <option value="+886">🇹🇼 +886</option>
  <option value="+992">🇹🇯 +992</option>
  <option value="+255">🇹🇿 +255</option>
  <option value="+66">🇹🇭 +66</option>
  <option value="+670">🇹🇱 +670</option>
  <option value="+228">🇹🇬 +228</option>
  <option value="+690">🇹🇰 +690</option>
  <option value="+676">🇹🇴 +676</option>
  <option value="+1-868">🇹🇹 +1-868</option>
  <option value="+216">🇹🇳 +216</option>
  <option value="+90">🇹🇷 +90</option>
  <option value="+993">🇹🇲 +993</option>
  <option value="+688">🇹🇻 +688</option>
  <option value="+256">🇺🇬 +256</option>
  <option value="+380">🇺🇦 +380</option>
  <option value="+971">🇦🇪 +971</option>
  <option value="+44">🇬🇧 +44</option>
  <option value="+1">🇺🇸 +1</option>
  <option value="+598">🇺🇾 +598</option>
  <option value="+998">🇺🇿 +998</option>
  <option value="+678">🇻🇺 +678</option>
  <option value="+39-06">🇻🇦 +39-06</option>
  <option value="+58">🇻🇪 +58</option>
  <option value="+84">🇻🇳 +84</option>
  <option value="+681">🇼🇫 +681</option>
  <option value="+967">🇾🇪 +967</option>
  <option value="+260">🇿🇲 +260</option>
  <option value="+263">🇿🇼 +263</option>
`;

  function addContactRow(idPrefix) {
  const labels = {
    father: "Father's Number",
    mother: "Mother's Number",
    brother: "Brother's Number",
    sister: "Sister's Number",
    uncle: "Uncle's Number",
    aunty: "Aunty's Number"
  };
  const isRequired = (idPrefix === "father" || idPrefix === "mother") ? "required" : "";
  const requiredMark = isRequired ? '<span style="color: red;">*</span>' : "";

  return `
    <div class="form-group">
      <label>${labels[idPrefix]} ${requiredMark}</label>
      <div class="row">
        <select id="${idPrefix}Code" class="country-code">${countryOptions}</select>
        <input type="tel" id="${idPrefix}" placeholder="${labels[idPrefix]}" ${isRequired} />
      </div>
    </div>
  `;
}




const countryPhoneLengths = {
  "+1": [10],             // USA, Canada, etc.
  "+7": [10],             // Russia, Kazakhstan
  "+20": [10],            // Egypt
  "+27": [9],             // South Africa
  "+30": [10],            // Greece
  "+31": [9],             // Netherlands
  "+32": [9],             // Belgium
  "+33": [9],             // France
  "+34": [9],             // Spain
  "+36": [9],             // Hungary
  "+39": [10],            // Italy
  "+40": [9],             // Romania
  "+41": [9],             // Switzerland
  "+43": [10],            // Austria
  "+44": [10],            // UK
  "+45": [8],             // Denmark
  "+46": [9],             // Sweden
  "+47": [8],             // Norway
  "+48": [9],             // Poland
  "+49": [10,11],         // Germany
  "+51": [9],             // Peru
  "+52": [10],            // Mexico
  "+53": [8],             // Cuba
  "+54": [10],            // Argentina
  "+55": [10,11],         // Brazil
  "+56": [9],             // Chile
  "+57": [10],            // Colombia
  "+58": [10],            // Venezuela
  "+60": [9,10],          // Malaysia
  "+61": [9],             // Australia
  "+62": [10,11],         // Indonesia
  "+63": [10],            // Philippines
  "+64": [8,9],           // New Zealand
  "+65": [8],             // Singapore
  "+66": [9],             // Thailand
  "+81": [10],            // Japan
  "+82": [9,10],          // South Korea
  "+84": [9,10],          // Vietnam
  "+86": [11],            // China
  "+90": [10],            // Turkey
  "+91": [10],            // India
  "+92": [10],            // Pakistan
  "+93": [9],             // Afghanistan
  "+94": [9],             // Sri Lanka
  "+95": [7,8],           // Myanmar
  "+98": [10,11],         // Iran
  "+212": [9],            // Morocco
  "+213": [9],            // Algeria
  "+216": [8],            // Tunisia
  "+218": [9],            // Libya
  "+220": [7],            // Gambia
  "+221": [9],            // Senegal
  "+222": [8],            // Mauritania
  "+223": [8],            // Mali
  "+224": [9],            // Guinea
  "+225": [10],           // Ivory Coast
  "+226": [8],            // Burkina Faso
  "+227": [8],            // Niger
  "+228": [8],            // Togo
  "+229": [8],            // Benin
  "+230": [8],            // Mauritius
  "+231": [7,8],          // Liberia
  "+232": [8],            // Sierra Leone
  "+233": [9],            // Ghana
  "+234": [10],           // Nigeria
  "+235": [8],            // Chad
  "+236": [7,8],          // Central African Republic
  "+237": [9],            // Cameroon
  "+238": [7],            // Cape Verde
  "+239": [7],            // Sao Tome and Principe
  "+240": [9],            // Equatorial Guinea
  "+241": [8],            // Gabon
  "+242": [9],            // Congo
  "+243": [9],            // DR Congo
  "+244": [9],            // Angola
  "+245": [7],            // Guinea-Bissau
  "+246": [7],            // British Indian Ocean Territory
  "+248": [7],            // Seychelles
  "+249": [9],            // Sudan
  "+250": [9],            // Rwanda
  "+251": [9],            // Ethiopia
  "+252": [8],            // Somalia
  "+253": [7],            // Djibouti
  "+254": [9],            // Kenya
  "+255": [9],            // Tanzania
  "+256": [9],            // Uganda
  "+257": [8],            // Burundi
  "+258": [9],            // Mozambique
  "+260": [9],            // Zambia
  "+261": [9],            // Madagascar
  "+262": [9],            // Réunion, Mayotte
  "+263": [9],            // Zimbabwe
  "+264": [9],            // Namibia
  "+265": [9],            // Malawi
  "+266": [8],            // Lesotho
  "+267": [7],            // Botswana
  "+268": [8],            // Eswatini
  "+269": [7],            // Comoros
  "+290": [4],            // Saint Helena
  "+291": [7],            // Eritrea
  "+297": [7],            // Aruba
  "+298": [6],            // Faroe Islands
  "+299": [6],            // Greenland
  "+350": [8],            // Gibraltar
  "+351": [9],            // Portugal
  "+352": [8,9],          // Luxembourg
  "+353": [9],            // Ireland
  "+354": [7],            // Iceland
  "+355": [9],            // Albania
  "+356": [8],            // Malta
  "+357": [8],            // Cyprus
  "+358": [9,10],         // Finland
  "+359": [9],            // Bulgaria
  "+370": [8],            // Lithuania
  "+371": [8],            // Latvia
  "+372": [7],            // Estonia
  "+373": [8],            // Moldova
  "+374": [8],            // Armenia
  "+375": [9],            // Belarus
  "+376": [6],            // Andorra
  "+377": [8],            // Monaco
  "+378": [8],            // San Marino
  "+380": [9],            // Ukraine
  "+381": [8,9],          // Serbia
  "+382": [8],            // Montenegro
  "+385": [8],            // Croatia
  "+386": [8],            // Slovenia
  "+387": [8],            // Bosnia and Herzegovina
  "+389": [8],            // North Macedonia
  "+420": [9],            // Czech Republic
  "+421": [9],            // Slovakia
  "+423": [7],            // Liechtenstein
  "+500": [5],            // Falkland Islands
  "+501": [7],            // Belize
  "+502": [8],            // Guatemala
  "+503": [8],            // El Salvador
  "+504": [8],            // Honduras
  "+505": [8],            // Nicaragua
  "+506": [8],            // Costa Rica
  "+507": [7],            // Panama
  "+508": [6],            // Saint Pierre and Miquelon
  "+509": [8],            // Haiti
  "+590": [9],            // Guadeloupe
  "+591": [7,8],          // Bolivia
  "+592": [7],            // Guyana
  "+593": [9],            // Ecuador
  "+594": [9],            // French Guiana
  "+595": [7,8],          // Paraguay
  "+596": [9],            // Martinique
  "+597": [7],            // Suriname
  "+598": [8],            // Uruguay
  "+599": [7],            // Curaçao, Sint Maarten
  "+670": [7],            // Timor-Leste
  "+672": [6],            // Australian external territories
  "+673": [7],            // Brunei
  "+674": [5],            // Nauru
  "+675": [7],            // Papua New Guinea
  "+676": [6],            // Tonga
  "+677": [7],            // Solomon Islands
  "+678": [7],            // Vanuatu
  "+679": [7],            // Fiji
  "+680": [6],            // Palau
  "+681": [6],            // Wallis and Futuna
  "+682": [5],            // Cook Islands
  "+683": [5],            // Niue
  "+685": [5],            // Samoa
  "+686": [7],            // Kiribati
  "+687": [6],            // New Caledonia
  "+688": [5],            // Tuvalu
  "+689": [6],            // French Polynesia
  "+690": [5],            // Tokelau
  "+691": [7],            // Micronesia
  "+692": [7],            // Marshall Islands
  "+850": [8,9],          // North Korea
  "+852": [8],            // Hong Kong
  "+853": [8],            // Macau
  "+855": [8,9],          // Cambodia
  "+856": [8],            // Laos
  "+870": [7],            // Inmarsat SNAC
  "+880": [10,11],        // Bangladesh
  "+886": [9],            // Taiwan
  "+960": [7],            // Maldives
  "+961": [8],            // Lebanon
  "+962": [9],            // Jordan
  "+963": [9],            // Syria
  "+964": [10],           // Iraq
  "+965": [8],            // Kuwait
  "+966": [9],            // Saudi Arabia
  "+967": [9],            // Yemen
  "+968": [8],            // Oman
  "+970": [9],            // Palestine
  "+971": [9],            // UAE
  "+972": [9],            // Israel
  "+973": [8],            // Bahrain
  "+974": [8],            // Qatar
  "+975": [8],            // Bhutan
  "+976": [8],            // Mongolia
  "+977": [10],           // Nepal
  "+992": [9],            // Tajikistan
  "+993": [8],            // Turkmenistan
  "+994": [9],            // Azerbaijan
  "+995": [9],            // Georgia
  "+996": [9],            // Kyrgyzstan
  "+998": [9],            // Uzbekistan
};

  // Get all input/select pairs
  const contacts = [
    {codeId: "fatherCode", inputId: "father"},
    {codeId: "motherCode", inputId: "mother"},
    {codeId: "brotherCode", inputId: "brother"},
    {codeId: "sisterCode", inputId: "sister"},
    {codeId: "uncleCode", inputId: "uncle"},
    {codeId: "auntyCode", inputId: "aunty"},
  ];

  contacts.forEach(({codeId, inputId}) => {
    const codeSelect = document.getElementById(codeId);
    const phoneInput = document.getElementById(inputId);

    // Only allow numbers as input
    phoneInput.addEventListener("input", e => {
      // Remove non-numeric characters
      e.target.value = e.target.value.replace(/\D/g, "");
      validatePhone(codeSelect, phoneInput);
    });

    // Validate on country code change
    codeSelect.addEventListener("change", () => validatePhone(codeSelect, phoneInput));

    // Initial validation in case of prefilled values
    validatePhone(codeSelect, phoneInput);
  });

 function validatePhone(codeSelect, phoneInput) {
  const countryCode = codeSelect.value;
  const phoneNumber = phoneInput.value;

  const validLengths = countryPhoneLengths[countryCode];

  // Get or create error message element below input
  let errorEl = phoneInput.nextElementSibling;
  if (!errorEl || !errorEl.classList.contains('phone-error')) {
    errorEl = document.createElement('small');
    errorEl.className = 'phone-error';
    errorEl.style.color = 'red';
    errorEl.style.fontSize = '0.8rem';
    errorEl.style.display = 'block';
    errorEl.style.marginTop = '2px';
    phoneInput.parentNode.appendChild(errorEl);
  }

  if (!validLengths) {
    // No length rules for this country code
    phoneInput.style.borderColor = "";
    errorEl.textContent = "";
    return true; // valid by default
  }

  if (validLengths.includes(phoneNumber.length)) {
    phoneInput.style.borderColor = "";
    errorEl.textContent = "";
    return true; // valid
  } else {
    phoneInput.style.borderColor = "red";
    errorEl.textContent = "Invalid phone number length for selected country.";
    return false; // invalid
  }
}
function validatePhone(codeSelect, phoneInput) {
  const countryCode = codeSelect.value;
  const phoneNumber = phoneInput.value;

  const validLengths = countryPhoneLengths[countryCode];

  // Get or create error message element below input
  let errorEl = phoneInput.nextElementSibling;
  if (!errorEl || !errorEl.classList.contains('phone-error')) {
    errorEl = document.createElement('small');
    errorEl.className = 'phone-error';
    errorEl.style.color = 'red';
    errorEl.style.fontSize = '0.8rem';
    errorEl.style.display = 'block';
    errorEl.style.marginTop = '2px';
    phoneInput.parentNode.appendChild(errorEl);
  }

  // ✅ If input is empty, treat as neutral (not invalid)
  if (phoneNumber.trim() === "") {
    phoneInput.style.borderColor = "";
    errorEl.textContent = "";
    return true;
  }

  // If no rules for this country, skip validation
  if (!validLengths) {
    phoneInput.style.borderColor = "";
    errorEl.textContent = "";
    return true;
  }

  // Validate length
  if (validLengths.includes(phoneNumber.length)) {
    phoneInput.style.borderColor = "";
    errorEl.textContent = "";
    return true;
  } else {
    phoneInput.style.borderColor = "red";
    errorEl.textContent = "Invalid phone number length for selected country.";
    return false;
  }



  // Additional phone validation for all contacts
  for (const {codeId, inputId} of contacts) {
    const codeSelect = document.getElementById(codeId);
    const phoneInput = document.getElementById(inputId);
    if (!validatePhone(codeSelect, phoneInput)) {
      allValid = false;
    }
  }

  generateBtn.style.display = allValid ? "inline-block" : "none";
}


  
document.addEventListener("DOMContentLoaded", function () {
  const nameInput = document.getElementById('name');
  const institutionInput = document.getElementById('institution');
  const nameCount = document.getElementById('nameCount');
  const instCount = document.getElementById('instCount');

  if (nameInput && nameCount) {
    nameInput.addEventListener('input', function () {
      nameCount.textContent = `${this.value.length}/30`;
    });
  }

  if (institutionInput && instCount) {
    institutionInput.addEventListener('input', function () {
      instCount.textContent = `${this.value.length}/42`;
    });
  }
});

let cropper;
const photoInput = document.getElementById('photo');
const imagePreview = document.getElementById('imagePreview');
const cropBtn = document.getElementById('cropBtn');
const cropNotice = document.getElementById('cropNotice');
const finalPhoto = document.getElementById('finalPhoto');

photoInput.addEventListener('change', function (e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (event) {
    imagePreview.src = event.target.result;
    imagePreview.style.display = 'block';
    cropBtn.style.display = 'inline-block';
    cropNotice.style.display = 'none';

    if (cropper) cropper.destroy();

    cropper = new Cropper(imagePreview, {
      aspectRatio: 1,
      viewMode: 1
    });
  };
  reader.readAsDataURL(file);
});

cropBtn.addEventListener('click', function () {
  if (!cropper) return;

  const canvasData = cropper.getCroppedCanvas({
    width: 300,
    height: 300,
  });

  finalPhoto.src = canvasData.toDataURL("image/png");

  cropper.destroy();
  cropper = null;

  imagePreview.style.display = 'none';
  cropBtn.style.display = 'none';
  cropNotice.style.display = 'inline-block';
});

document.addEventListener("DOMContentLoaded", () => {
  // Populate all existing selects with country options
  document.querySelectorAll('.country-code').forEach(select => {
    select.innerHTML = countryOptions;
  });

  const extraContacts = ["brother", "sister", "uncle", "aunty"];
  const labels = {
    father: "Father's Number",
    mother: "Mother's Number",
    brother: "Brother's Number",
    sister: "Sister's Number",
    uncle: "Uncle's Number",
    aunty: "Aunty's Number",
  };

  const placeholders = {
    father: "Father's Phone Number",
    mother: "Mother's Phone Number",
    brother: "Brother's Phone Number",
    sister: "Sister's Phone Number",
    uncle: "Uncle's Phone Number",
    aunty: "Aunty's Phone Number",
  };

  const container = document.getElementById("emergencyContactsContainer");

  extraContacts.forEach((key) => {
    // Skip if already in HTML (from static section)
    if (document.getElementById(key)) return;

    const formGroup = document.createElement("div");
    formGroup.classList.add("form-group");

    const label = document.createElement("label");
    label.textContent = labels[key];
    formGroup.appendChild(label);

    const row = document.createElement("div");
    row.classList.add("row");

    const select = document.createElement("select");
    select.id = key + "Code";
    select.className = "country-code";
    select.innerHTML = countryOptions;

    const input = document.createElement("input");
    input.type = "tel";
    input.id = key;
    input.placeholder = placeholders[key];

    row.appendChild(select);
    row.appendChild(input);
    formGroup.appendChild(row);

    container.appendChild(formGroup);
  });

  // === Validation and Generate Button Control ===
  const generateBtn = document.querySelector('button[onclick="generateID()"]');
  generateBtn.style.display = "none"; // hide initially

  // List all required field IDs
const requiredFields = [
  "name",
  "dob",
  "institution",
  "blood",
  "gender",
  "nationality",
  "father",
  "fatherCode",
  "mother",
  "motherCode",
  "address",
  "photo"
];

  function isFileSelected(input) {
    return input.files && input.files.length > 0;
  }

  function validateForm() {
    let allValid = true;

    for (const id of requiredFields) {
      const el = document.getElementById(id);
      if (!el) continue;

      if (el.tagName === "SELECT") {
        if (!el.value) {
          allValid = false;
          break;
        }
      } else if (el.tagName === "INPUT") {
        if (el.type === "file") {
          if (!isFileSelected(el)) {
            allValid = false;
            break;
          }
        } else {
          if (!el.value.trim()) {
            allValid = false;
            break;
          }
        }
      } else if (el.tagName === "TEXTAREA") {
        if (!el.value.trim()) {
          allValid = false;
          break;
        }
      }
    }

    generateBtn.style.display = allValid ? "inline-block" : "none";
  }

  // Attach event listeners to required fields
  requiredFields.forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;

    el.addEventListener("input", validateForm);
    if (el.tagName === "SELECT") {
      el.addEventListener("change", validateForm);
    }
    if (el.type === "file") {
      el.addEventListener("change", validateForm);
    }
  });

  // Initial check (in case fields are pre-filled)
  validateForm();
});


  function showForm() {
    document.getElementById("intro").classList.add("hidden");
    document.getElementById("formSection").classList.remove("hidden");
  }

  function generateID() {
document.getElementById("printInstructions").style.display = "block";


    document.getElementById("output").classList.remove("hidden");
document.getElementById("actionButtons").style.display = "block";

// Setup download button
document.getElementById("downloadBtn").onclick = () => {
  const idCard = document.getElementById("idCard");

  html2canvas(idCard, {
    scale: 3, // boost quality for printing (simulates higher DPI)
    useCORS: true, // enables cross-origin images if needed
    backgroundColor: null // keeps background clean/transparent if set
  }).then(canvas => {
    const link = document.createElement("a");
    link.download = "ID_Card.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  });
};

document.getElementById("newIDBtn").onclick = () => {
  // Hide output section and action buttons
  document.getElementById("output").classList.add("hidden");
  document.getElementById("actionButtons").style.display = "none";
  document.getElementById("printInstructions").style.display = "none";

  // Clear all form fields inside the form section
  const inputs = document.querySelectorAll("#formSection input, #formSection select, #formSection textarea");
  inputs.forEach(input => {
    if (input.type === "file") {
      input.value = null;
    } else if (input.tagName === "SELECT") {
      input.selectedIndex = 0;
    } else {
      input.value = "";
    }
  });

  // Reset character counters
  document.getElementById("nameCount").textContent = "0/30";
  document.getElementById("instCount").textContent = "0/42";

  // Hide image preview, crop button and crop notice
  const imagePreview = document.getElementById('imagePreview');
  const cropBtn = document.getElementById('cropBtn');
  const cropNotice = document.getElementById('cropNotice');
  const finalPhoto = document.getElementById('finalPhoto');

  imagePreview.style.display = "none";
  cropBtn.style.display = "none";
  cropNotice.style.display = "none";
  finalPhoto.src = "";

  // Scroll to top smoothly
  window.scrollTo({ top: 0, behavior: "smooth" });

  // Show form section and hide intro if hidden
  document.getElementById("formSection").classList.remove("hidden");
  document.getElementById("intro").classList.add("hidden");

  // Hide Generate ID button initially (it shows only when form is valid)
  const generateBtn = document.querySelector('button[onclick="generateID()"]');
  generateBtn.style.display = "none";
};


// Setup print button
document.getElementById("printBtn").onclick = () => {
  const idCardElement = document.getElementById("idCard");

  html2canvas(idCardElement, {
    scale: 3, // Higher scale for better quality
    backgroundColor: "#fff" // Ensure white background
  }).then(canvas => {
    const imgData = canvas.toDataURL("image/png");

    const printWindow = window.open("", "_blank", "width=800,height=600");
    printWindow.document.write(`
      <html>
        <head>
          <title>Print ID Card</title>
          <style>
            @page {
              size: 3.375in 2.125in;
              margin: 0;
            }
            html, body {
              margin: 0;
              padding: 0;
              background: white;
              height: 100%;
              display: flex;
              justify-content: center;
              align-items: center;
            }
            img {
              width: 3.375in;
              height: 2.125in;
              display: block;
            }
          </style>
        </head>
        <body>
          <img src="${imgData}" alt="ID Card" />
        </body>
      </html>
    `);

    printWindow.document.close();
    printWindow.focus();
    
    // Delay ensures everything loads before printing
    setTimeout(() => {
      printWindow.print();
      printWindow.close();
    }, 600);
  });
};
    const get = id => document.getElementById(id).value.trim();

    const name = get("name");
    const dob = get("dob");
    const institution = get("institution");
    const blood = get("blood");
    const gender = get("gender");
    const nationality = get("nationality");
    const address = get("address");

    // Gather contacts
   const contactsList = ["mother", "father", "brother", "sister", "uncle", "aunty"];

    let contacts = {};
    contactsList.forEach(person => {
      const code = get(person + "Code");
      const number = get(person);
      contacts[person] = number ? code + " " + number : "N/A";
    });

    // Load photo
    const file = document.getElementById("photo").files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function () {
        document.getElementById("imagePreview").src = reader.result;
      };
      reader.readAsDataURL(file);
    } else {
      document.getElementById("imagePreview").src = "";
    }

    document.getElementById("outName").textContent = name || "-";
    document.getElementById("outDOB").textContent = dob || "-";
    document.getElementById("outInst").textContent = institution || "-";
    document.getElementById("outBlood").textContent = blood || "-";
    document.getElementById("outGender").textContent = gender || "-";
    


    // Prepare QR text with all details, nicely formatted
    let qrText = `Name: ${name || "-"}
DOB: ${dob || "-"}
Institution: ${institution || "-"}
Blood Group: ${blood || "-"}
Gender: ${gender || "-"}
Nationality: ${nationality || "-"}
Address: ${address || "-"}

Emergency Contacts:
Mother: ${contacts.mother}
Father: ${contacts.father}
Brother: ${contacts.brother}
Sister: ${contacts.sister}
Uncle: ${contacts.uncle}
Aunty: ${contacts.aunty}
`;

   // Assuming qrText contains the data to encode in the QR
if (!qrText) {
  alert("No data provided for QR code.");
  return;
}

const qrContainer = document.getElementById("qr");

// Clear existing QR code
qrContainer.innerHTML = "";

const canvas = document.createElement("canvas");
canvas.width = 240;    // Set canvas bitmap width
canvas.height = 240

// Generate QR code with high quality
QRCode.toCanvas(canvas, qrText, {
  width: 240, // ~1in at 240dpi for print-ready sizing
  margin: 0,
  errorCorrectionLevel: 'H'
}, function (error) {
  if (error) {
    console.error("QR Generation Failed:", error);
    alert("Error generating QR code!");
    return;
  }

  // Style the canvas for printing
  canvas.style.border = "1px solid #ccc";
  canvas.style.borderRadius = "8px";
  canvas.style.padding = "2px";
  canvas.style.backgroundColor = "#fff";
  canvas.style.width = "1in";
  canvas.style.height = "1in";
  canvas.style.imageRendering = "pixelated";

  qrContainer.appendChild(canvas);
});

document.getElementById("output").classList.remove("hidden");



  }
</script>

</body>
</html>
